<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Travel Advisory Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}" />
    <style>
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: linear-gradient(to right, #dbeafe, #f0f9ff);
        color: #1e293b;
      }
      .container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
      }
      header h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      header p {
        color: #475569;
      }
      .form-container {
        margin-top: 2rem;
      }
      .form-group {
        margin-bottom: 1.5rem;
      }
      label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.5rem;
      }
      input[type="text"],
      select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #cbd5e1;
        border-radius: 0.5rem;
        font-size: 1rem;
      }
      input[type="checkbox"] {
        margin-right: 0.5rem;
      }
      button {
        background-color: #2563eb;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      button:hover {
        background-color: #1e40af;
      }
      .results-container {
        margin-top: 2rem;
      }
      .spinner {
        width: 30px;
        height: 30px;
        border: 4px solid #cbd5e1;
        border-top: 4px solid #2563eb;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 1rem auto;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .list-item {
        background: #f1f5f9;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .list-number {
        font-weight: bold;
        margin-right: 0.5rem;
      }
      #copyBtn {
        margin-top: 1rem;
        background-color: #10b981;
      }
      #copyBtn:hover {
        background-color: #059669;
      }
      .error {
        color: #dc2626;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Travel Advisory & Destination Guide Generator</h1>
        <p>
          Instantly craft helpful, AI-powered travel advisories for your next
          journey.
        </p>
      </header>

      <div class="form-container">
        <form id="ideaForm">
          <div class="form-group">
            <label for="niche">Destination or Location:</label>
            <input
              type="text"
              id="niche"
              name="niche"
              required
              placeholder="e.g., Paris, Tokyo, Ladakh, Bali"
            />
          </div>

          <div class="form-group">
            <label for="num_ideas">Number of Advisories:</label>
            <select id="num_ideas" name="num_ideas">
              <option value="1">1</option>
              <option value="3" selected>3</option>
              <option value="5">5</option>
              <option value="10">10</option>
            </select>
          </div>

          <div class="form-group">
            <label for="tone">Tone of Advisory:</label>
            <select id="tone" name="tone">
              <option value="professional" selected>Professional</option>
              <option value="casual">Casual</option>
              <option value="humorous">Humorous</option>
              <option value="inspirational">Inspirational</option>
              <option value="educational">Educational</option>
            </select>
          </div>

          <div class="form-group checkbox">
            <input
              type="checkbox"
              id="include_outline"
              name="include_outline"
              checked
            />
            <label for="include_outline">Include Detailed Outline</label>
          </div>

          <div class="form-group">
            <label for="model">LLM Model:</label>
            <select id="model" name="model">
              <option value="mistral" selected>mistral</option>
            </select>
          </div>

          <button type="submit" id="generateBtn">Generate Advisory</button>
        </form>
      </div>

      <div
        class="results-container"
        id="resultsContainer"
        style="display: none"
      >
        <h2>Your Travel Advisory</h2>
        <div id="loading" style="display: none">
          <div class="spinner"></div>
          <p>Crafting your travel insights...</p>
        </div>
        <div id="results"></div>
        <button id="copyBtn">Copy to Clipboard</button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const response = await fetch("/models");
          const data = await response.json();
          const modelSelect = document.getElementById("model");
          modelSelect.innerHTML = "";
          data.models.forEach((model) => {
            const option = document.createElement("option");
            option.value = model;
            option.textContent = model;
            modelSelect.appendChild(option);
          });
        } catch (error) {
          console.error("Error fetching models:", error);
        }
      });

      document
        .getElementById("ideaForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);
          const resultsContainer = document.getElementById("resultsContainer");
          const loading = document.getElementById("loading");
          const results = document.getElementById("results");

          resultsContainer.style.display = "block";
          loading.style.display = "block";
          results.innerHTML = "";

          try {
            const response = await fetch("/generate", {
              method: "POST",
              body: formData,
            });

            if (!response.ok) throw new Error(`Error: ${response.statusText}`);

            const data = await response.json();
            results.innerHTML = formatResponseWithMarkdown(
              data.generated_ideas
            );
          } catch (error) {
            results.innerHTML = `<div class="error">Error: ${error.message}</div>`;
          } finally {
            loading.style.display = "none";
          }
        });

      document.getElementById("copyBtn").addEventListener("click", () => {
        const results = document.getElementById("results").innerText;
        navigator.clipboard
          .writeText(results)
          .then(() => {
            const copyBtn = document.getElementById("copyBtn");
            copyBtn.textContent = " Copied!";
            setTimeout(
              () => (copyBtn.textContent = " Copy to Clipboard"),
              2000
            );
          })
          .catch((err) => console.error("Failed to copy: ", err));
      });

      function formatResponseWithMarkdown(text) {
        let formatted = text.replace(/\n/g, "<br>");
        formatted = formatted.replace(
          /#{1,6}\s+(.*?)(?:<br>|$)/g,
          "<h3>$1</h3>"
        );
        formatted = formatted.replace(
          /(\d+\.\s+)(.*?)(?:<br>|$)/g,
          '<div class="list-item"><span class="list-number">$1</span>$2</div>'
        );
        formatted = formatted.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
        formatted = formatted.replace(/\*(.*?)\*/g, "<em>$1</em>");
        return formatted;
      }
    </script>
  </body>
</html>
